# Как писать инструкции для Claude Code

---

## Цель документа

- **Научить** создавать качественные инструкции для Claude Code
- **Применимо** к любому языку/фреймворку (Flutter/Dart, .NET, React, и т.д.)
- **Обеспечить** единый стандарт написания инструкций в команде

---

## Структура папок .claude/

### Общая структура

```
CLAUDE.md                           # Главный файл (Always Apply)
.claude/
├── common/                        # Глобальные инструкции проекта
├── common-{language}/             # Специфика языка программирования
├── common-{framework}/            # Специфика фреймворка
├── architecture/                  # Архитектурные паттерны
├── layers/                        # Папка для хранения специфичных инструкций back/front
├── database/                     # Работа с данными
├── api/                          # API и сеть
├── modules/                      # Модульная разработка
└── commands/                     # Slash-команды
```

### CLAUDE.md файл

### Что должен содержать, если лежит в корне проекта

- Четкое определение роли и сферы ее действия ИИ.
- Базовая информация о проекте
- Ссылки на другие файлы интсрукции

#### Где размещать CLAUDE.md:

- в корне репозитория или там, откуда обычно запускается claude (самый частый вариант). Файл стоит закоммитить в git — так его увидят все члены команды. Либо использовать CLAUDE.local.md и добавить его в .gitignore; Содержит в себе базовая информация + ссылки на другие файлы инструкций.

- в любой родительской папке относительно точки запуска. Это удобно в монорепозиториях — например, если мы запускаем claude из root/foo, файлы root/CLAUDE.md и root/foo/CLAUDE.md оба подтянутся в контекст. Если файл кладем в root/foo/CLAUDE.md, то описываем модуль foo, возможно с ссылками на файлы инструкций специфичных для модуля foo. Например только foo содержит database то укажим ссылку на инструкцию .claude/database

- в домашней папке (~/.claude/CLAUDE.md) — такой файл применяется во всех сессиях claude. Пока не придумал как это будет работать (TODO)

### Детальная структура папок

#### common/ - Глобальные инструкции проекта

```
common/
├── project-overview.md        # Обзор проекта, структура проекта, базовая информация
├── team-conventions.md        # Соглашения команды
├── git-workflow.md            # Git workflow (merge/rebase)
├── makefile-commands.md       # Команды сборки/запуска
├── environment-setup.md       # Настройка окружения
└── deployment.md              # Деплой и CI/CD
```

#### common-{language}/ - Специфика языка

**Примеры:** `common-dart/`, `common-csharp/`, `common-python/`

```
common-{language}/
├── code-style.md              # Код-стайл языка
├── naming-conventions.md      # Naming conventions
├── language-features.md       # Современные фичи языка
├── testing.md                 # Тестирование на языке
└── performance.md             # Оптимизация производительности
```

#### common-{framework}/ - Специфика фреймворка

**Примеры:** `common-flutter/`, `common-aspnet/`, `common-react/`

```
common-{framework}/
├── framework-patterns.md      # Паттерны фреймворка
├── framework-widgets.md       # Компоненты/виджеты
├── state-management.md        # Управление состоянием
├── routing.md                 # Навигация/роутинг
└── best-practices.md          # Best practices фреймворка
```

#### architecture/ - Архитектурные паттерны

```
architecture/
├── architecture.md            # Architecture показать взаимосвязь между разными уровнями
├── state-manager-pattern.md   # Example use state manager
├── dependency-injection.md    # DI/IoC
```

#### layers/ - Папка для хранения специфичных инструкций в зависимости от front/back

Делим на подпапки по слоям

Для front можно сделать UI с инструкциями для UI

```
layers/
  presentation/
    ui/
    ├── theming.md                 # Темизация
    ├── widgets.md                 # Создание компонентов
    ├── implement-component.md     # Конкретная реализация компонента по Figma
    └── localization.md            # Локализация ui
  domain/                          # Инструкции под domain
```

Для backend можно сделать api-controllers, middleware

```
layers/
├── presentation/
│   ├── api-controllers/
│   │   ├── rest-controllers.md       # REST контроллеры
│   │   ├── request-validation.md     # Валидация запросов
│   │   ├── response-mapping.md       # Маппинг ответов
│   │   └── swagger-documentation.md  # API документация
│   └── middleware/
│       ├── authentication-middleware.md
│       ├── error-handling-middleware.md
│       └── logging-middleware.md
├── domain/
│   ├── entities.md                   # Domain entities
```

#### database/ - Работа с данными

```
database/
├── database-setup.md          # Настройка БД
├── migrations.md              # Миграции
└── queries.md                 # Оптимизация запросов
```

#### api/ - API и сеть

```
api/
├── rest-api.md                # REST API
├── graphql.md                 # GraphQL
└── error-handling.md          # Обработка ошибок
```

#### modules/ - Модульная разработка

Для монореп и конкретных проектов, для лучшего контекста можно описать взаимодействия между модулями например module-dependencies.md
Описать как строится фича - feature-modules.md

```
modules/
├── feature-modules.md         # Создание фич-модулей
└── module-dependencies.md     # Зависимости модулей
```

#### commands/ -команды

Пока содержит один файл

```
commands/
├── make-info.md               # Описаны все команды
```

---

## Анатомия хорошей инструкции

### Обязательные элементы

## Есть два вида инструкций - общего назначения и пошаговые.

##  Общего назначения

### например как писать на фреймворке

#### 1. Структура документа

1. **Заголовок** - четкое название
2. **Цель** - зачем эта инструкция
3. **Правила** - в формате "Правило-Обоснование-Пример"

**Таких правил в инструкции может быть сколько угодно**
**Пример Правила из инструкции общего назначения:**

#### Правило: Используй const для неизменяемых виджетов

**Обоснование:**

- Оптимизация производительности Flutter (виджет не пересоздается)
- Снижение потребления памяти (один экземпляр на все использования)
- Помощь анализатору в поиске потенциальных ошибок
- Явная декларация намерений ("этот виджет неизменяем")

**Пример:**

```dart
// ✅ ХОРОШО - const для статических виджетов
const Text('Hello World')
const SizedBox(height: 16)
const Icon(Icons.favorite)

// ❌ ПЛОХО - без const
Text('Hello World')
SizedBox(height: 16)
Icon(Icons.favorite)
```

## Пошаговые инструкции:

### например как сверстать целый UI компонент с использованием Figma или вставкой картинки маета элемента

#### 1. Структура документа

1. **Заголовок** - четкое название
2. **Цель** - зачем эта инструкция
3. **Порядок исполнения** - пошаговый план (если нужен)
4. **Контекст** - артефакты, ресурсы, связи
5. **Ссылки** - связанные инструкции

---

## Best Practices

### 1. Не понял человек - не поймет нейронка

Пиши так чтобы было понятно любому человеку

### 2. Держи CLAUDE.md и остальные инструкции актуальным

Регулярно пересматривай и обновляй инструкции
Инструкции будут пополняться и писаться итерационно.

---

### 3. Используй иерархию контекста

#### Правило

Claude подтягивает CLAUDE.md из разных уровней

#### Обоснование

- Монорепозитории могут иметь разные правила для подпроектов
- Глобальные правила + локальные правила = гибкость

#### Иерархия

1. `~/.claude/CLAUDE.md` - глобально для пользователя
2. `root/CLAUDE.md` - для всего монорепозитория
3. `root/foo/CLAUDE.md` - для конкретного модуля
4. `root/foo/bar/CLAUDE.md` - для вложенных папок

---

### 4. Управляй разрешениями инструментов

#### Правило

Настрой allowlist безопасных операций

#### Обоснование

- Ускоряет работу (не нужно подтверждать каждый раз)
- Безопасность (контроль опасных операций)

#### Способы

1. "Always allow" во время сессии
2. Команда `/permissions`
3. Редактирование `.claude/settings.json`
4. Флаг CLI `--allowedTools`

#### Пример

```json
{
  "allowedTools": [
    "Edit",
    "Bash(git commit:*)",
    "Bash(make *)",
    "mcp__figma__*"
  ]
}
```

---

### 5. Используй "think hard"

Добавляй в промпт think, think hard, ultrathink

---

### 6. Пиши все инструкции на Английском

(TODO - пока по желанию, нужно обсудить)
Все инструкции по дефолту вставляются перед промптом в ИИ, это увеличивает конекст. Если инструкции на Английском языке - это поможет сэкономить конекст

---

### 7. Можешь вставлять уточнения, по типу

❗ ОБЯЗАТЕЛЬНО: Действуй в этом порядке. Сообщай, если по какой-то причине ты отклонился от него.

ИЛИ

Для начала реализации компонента должно быть доступно:

1. Ссылка на компонент в Figma
2. Путь до класса UI компонента

❗ Если пользователь забыл передать их, напомни ему об этом перед стартом генерации.

---

### 8. Не делай больше CLAUDE.md файлы

Старайся их разбивать и внутри указывать ссылки на другие файлы. Так будет экономиться конекст, он не будет смешиваться с другими инструкциями.

---

### 9. Используй Mermaid для диаграмм

Используй синтаксис Mermaid для всех диаграмм в инструкциях вместо ASCII-art
